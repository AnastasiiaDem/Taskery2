<div style="margin: 3rem auto 2rem; text-align: center;" *ngIf="currentUser.role == 'ProjectManager'">
  <span class="tooltiptext">Add new project</span>
  <button (click)="addProject(addUpdateContent, $event)" mat-mini-fab aria-label="Create new task" class="add-btn" id="mat-btn">
    <mat-icon style="color: #666666 !important;">add</mat-icon>
  </button>
</div>

<img src="./assets/images/Scenes05.svg" alt="" class="scene5" *ngIf="!!projects.length">
<div class="projects-wrapper w3-animate-opacity" *ngIf="!!projects.length"
     [style]="currentUser.role == 'ProjectManager' ? '' : 'margin-top: 8rem;'">
  <div *ngFor="let  project of  projects; let idx = index">
    <div class="container" (dblclick)="openModal(previewContent, project)">
      <div class="card" [ngStyle]="{'margin': idx < 1 ? '0' : '0 auto', 'width': idx >= 1 ? '80%' : '60%'}">
        <div class="card-header px-lg-5">
          <p style="float: right; margin: 0;">{{project.status}}</p>
        </div>
        <div class="card-body">
          <h3>{{ project.projectName}}</h3>
          <p class="text-muted text-sm" [innerHTML]="project.description | safeHtml"></p>
        </div>
        <a [routerLink]="['/board', {'paramKey': project.id}]" class="btn corner" [ngStyle]="linkStyle(project)">
          go to the task list
        </a>
      </div>
    </div>
  </div>
</div>

<div class="no-content" *ngIf="!projects.length">
  <p>There is no data to display, you aren't assigned to any projectðŸ˜¢<br>If you would like to start your own project,
    please register new special (Project Manager) account</p>
</div>


<ng-template #addUpdateContent let-modal>
  <div class="container">
    <div class="row align-items-center">
      <div class="card-header px-lg-5">
        <div class="card-heading text-primary">{{addProjectFlag ? 'Add new project' : 'Update the project'}}</div>
      </div>
      <div class="card-body" style="padding: 2rem!important;">
        <form [formGroup]="projectForm" (ngSubmit)="onSubmit(modal)">
          <div class="form-floating" style="width: 100%; margin-bottom: 15px">
            <input class="form-control" type="text" placeholder="Project Name"
                   formControlName="projectName"
                   [ngClass]="{ 'is-invalid': submitted && projectForm.invalid && f.projectName.errors }" required>
            <label>Project Name</label>
          </div>
          <div class="form-floating mb-3">
            <quill-editor class="form-control" style="padding: 1rem .75rem; height: 150px;"
                          formControlName="description" placeholder="Description"
                          [modules]="quillConfig"></quill-editor>
          </div>
          <div class="form-floating right-field" style="margin-left: 0 !important;">
            <ng-select2 formControlName="status" [width]="'100%'" [data]="statusData">
            </ng-select2>
          </div>
          <div class="form-floating right-field" style="margin-left: 0 !important;">
            <ng-multiselect-dropdown
                [placeholder]="'Assign this project to the employees'"
                [settings]="dropdownSettings"
                [data]="usersData"
                formControlName="assignedUsers"
            >
            </ng-multiselect-dropdown>
          </div>
          <button class="btn btn-primary close-button" type="submit"
                  style="border-radius: 0 0 calc(1rem - 1px) calc(1rem - 1px)"
                  [disabled]="projectForm.invalid">submit
          </button>
        </form>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #previewContent let-modal>
  <div class="container">
    <div class="row align-items-center">
      <div class="card-body" style="padding: 2rem;">
        <div class="form-floating title-block">
          {{previewData.projectName}}
        </div>
        <hr class="line">
        <div class="body-content">
          <div class="left-block">
            <div class="form-floating">
              <p>STATUS</p>
              <span>{{previewData.status}}</span>
            </div>
            <div class="form-floating">
              <p>Created</p>
              <span>{{previewData.createdAt | date: 'shortDate'}}</span>
            </div>
            <div class="form-floating">
              <p>ASSIGNED EMPLOYEES</p>
              <span style="font-size: 12px; line-height: 13px;" [innerHTML]="previewData.assignedUsers | safeHtml"></span>
            </div>
          </div>
          <div class="right-block">
            <div class="form-floating description-block" [innerHTML]="previewData.description | safeHtml">
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="currentUser.role == 'ProjectManager'" class="card-footer">
        <div class="action-btns">
          <button class="update-task" (click)="updateProject(addUpdateContent, modal)">
            Update
          </button>
          <button class="delete-task" (click)="deleteProject(deleteContent, modal)">
            Delete
          </button>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #deleteContent let-modal>
  <div class="container">
    <div class="row align-items-center">
      <div class="card-body" style="padding: 3rem!important;">
        <h5 style="text-align: center;">Are you sure you want to delete this project?</h5>
        <div style="display: flex; justify-content: space-around; align-items: center; margin-top: 50px;">
          <button style="font-size: 13px;" class="btn btn-outline-danger" (click)="isDelete('cancel', modal)">Cancel</button>
          <button style="font-size: 13px;" class="btn btn-outline-primary" (click)="isDelete('confirm', modal)">Confirm</button>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ngx-spinner bdColor="rgb(170 170 170 / 50%)" size="default" color="rgb(32 32 32)" type="ball-atom"></ngx-spinner>
